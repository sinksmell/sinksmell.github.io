<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta http-equiv="content-type" content="text/html;charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noodp"/>
    <meta name="author" content="sinksmell">
    
    <meta name="keywords" content="go,golang,sinksmell">
    
    <link rel="prev" href="https://sinksmell.github.io/2020/leetcode-bsearch/" />
    
    <link rel="canonical" href="https://sinksmell.github.io/2020/note-cigo-ch01/" />
    
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">
    <title>
         
         
             Concurrency in Go è¯»ä¹¦ç¬”è®° ç¬¬ä¸€ç«  | SinkSmell | Blog
         
    </title>
    <meta name="title" content="Concurrency in Go è¯»ä¹¦ç¬”è®° ç¬¬ä¸€ç«  | SinkSmell | Blog">
      
  
  <link rel="stylesheet" href="/font/iconfont.css">
  <link rel="stylesheet" href="/css/main.min.css">


    
    
 

<script type="application/ld+json">
{   "@context" : "http://schema.org",
    "@type" : "BlogPosting",
    "mainEntityOfPage": {
         "@type": "WebPage",
         "@id": "https:\/\/sinksmell.github.io"
    },
    "articleSection" : "posts",
    "name" : "Concurrency in Go è¯»ä¹¦ç¬”è®° ç¬¬ä¸€ç« ",
    "headline" : "Concurrency in Go è¯»ä¹¦ç¬”è®° ç¬¬ä¸€ç« ",
    "description" : "å¹¶å‘ç®€ä»‹ Race Conditions ç«æ€ å‡ºç°æ¡ä»¶ ä¸¤ä¸ªåŠä»¥ä¸Šçš„æ“ä½œå¿…é¡»æŒ‰ç…§æ­£ç¡®åœ°é¡ºåºæ‰§è¡Œï¼Œä½†ç¨‹åºæœªå¯¹æ‰§è¡Œé¡ºåºè¿›è¡Œä¿è¯ï¼Œå°†ä¼šå‡ºç° race condition ç¤ºä¾‹ä»£ç  package main import \x26#34;fmt\x26#34; func main(){ var data int go func() { data \x2b\x2b",
    "inLanguage" : "en-us",
    "author" : "sinksmell",
    "creator" : "sinksmell",
    "publisher": "sinksmell",
    "accountablePerson" : "sinksmell",
    "copyrightHolder" : "sinksmell",
    "copyrightYear" : "2020",
    "datePublished": "2020-02-01 16:42:30 \x2b0800 \x2b0800",
    "dateModified" : "2020-02-01 16:42:30 \x2b0800 \x2b0800",
    "url" : "https:\/\/sinksmell.github.io\/2020\/note-cigo-ch01\/",
    "wordCount" : "1886",
    "keywords" : [ "concurrency in go","chapter1", "SinkSmell | Blog"]
}
</script>

  </head>
  
    
  
  
<aside class="side-toc">
    
    <nav id="TableOfContents">
  <ul>
    <li><a href="#å¹¶å‘ç®€ä»‹">å¹¶å‘ç®€ä»‹</a>
      <ul>
        <li><a href="#race-conditions-ç«æ€">Race Conditions ç«æ€</a></li>
        <li><a href="#atomicity-åŸå­æ€§">Atomicity åŸå­æ€§</a></li>
        <li><a href="#memory-access-synchronization">Memory Access Synchronization</a></li>
        <li><a href="#deadlockslivelocksand-starvation">Deadlocks,Livelocks,and Starvation</a></li>
        <li><a href="#determining-concurrency-safety-ç¡®å®šå¹¶å‘å®‰å…¨">Determining Concurrency Safety ç¡®å®šå¹¶å‘å®‰å…¨</a></li>
      </ul>
    </li>
  </ul>
</nav>
</aside>

  <body class="">
    <div class="wrapper">
        <nav class="navbar">
    
        <div class="top-scroll-bar"></div>
    
    <div class="container">
        <div class="navbar-header header-logo">
        	<a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="https://sinksmell.github.io">SinkSmell | Blog</a>
        </div>
        <div class="menu navbar-right">
                
                
                <a class="menu-item" href="/posts/" title="">Archive</a>
                
                <a class="menu-item" href="/categories/" title="">Categories</a>
                
                <a class="menu-item" href="/tags/" title="">Tags</a>
                
                <a class="menu-item" href="/about/" title="">About</a>
                
        </div>
    </div>
</nav>
<nav class="navbar-mobile" id="nav-mobile" style="display: none">
    
        <div class="top-scroll-bar"></div>
    
     <div class="container">
        <div class="navbar-header">
            <div>  <a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="https://sinksmell.github.io">SinkSmell | Blog</a></div>
            <div class="menu-toggle">
                <span></span><span></span><span></span>
            </div>
        </div>
     
          <div class="menu" id="mobile-menu">
                
                
                <a class="menu-item" href="/posts/" title="">Archive</a>
                
                <a class="menu-item" href="/categories/" title="">Categories</a>
                
                <a class="menu-item" href="/tags/" title="">Tags</a>
                
                <a class="menu-item" href="/about/" title="">About</a>
                
        </div>
    </div>
</nav>
        
        <div id="landlord">
          <div class="message" style="opacity:0"></div>
          <canvas id="live2d" width="280" height="250" class="live2d"></canvas>
          <div class="hide-button">éšè—</div>
       </div>
    	 <main class="main">
          <div class="container">
      		
<article class="post-warp" itemscope itemtype="http://schema.org/Article">
    <header class="post-header">
        <h1 class="post-title" itemprop="name headline">Concurrency in Go è¯»ä¹¦ç¬”è®° ç¬¬ä¸€ç« </h1>
        <div class="post-meta">
                å‘è¡¨äº 
                <span class="post-time">
                    <time datetime=2020-02-01 itemprop="datePublished">February 1, 2020</time>
                </span>
                | åˆ†ç±»äº
                
                <span class="post-category">
                        <a href="https://sinksmell.github.io/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"> è¯»ä¹¦ç¬”è®° </a>
                        
                </span>
                <span class="post-word-count">ï¼ˆ1886 Wordsï¼Œé˜…è¯»æ—¶é—´çº¦ 5 Minï¼‰</span>
        </div>
    </header>
    <div class="post-content">
        

        
            
        

        
        
     
          
          
          

          
          
          

          <h2 id="å¹¶å‘ç®€ä»‹">å¹¶å‘ç®€ä»‹</h2>
<h3 id="race-conditions-ç«æ€">Race Conditions ç«æ€</h3>
<p><strong>å‡ºç°æ¡ä»¶</strong></p>
<blockquote>
<p>ä¸¤ä¸ªåŠä»¥ä¸Šçš„æ“ä½œå¿…é¡»æŒ‰ç…§æ­£ç¡®åœ°é¡ºåºæ‰§è¡Œï¼Œä½†ç¨‹åºæœªå¯¹æ‰§è¡Œé¡ºåºè¿›è¡Œä¿è¯ï¼Œå°†ä¼šå‡ºç° <em>race condition</em></p>
</blockquote>
<p><strong>ç¤ºä¾‹ä»£ç </strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>

<span style="color:#f92672">import</span> <span style="color:#e6db74">&#34;fmt&#34;</span>

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>(){
	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">data</span> <span style="color:#66d9ef">int</span>
	<span style="color:#66d9ef">go</span> <span style="color:#66d9ef">func</span>() {
		<span style="color:#a6e22e">data</span> <span style="color:#f92672">++</span>
	}()
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">data</span><span style="color:#f92672">==</span><span style="color:#ae81ff">0</span>{
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;the value is %v\n&#34;</span>,<span style="color:#a6e22e">data</span>)
	}
}

</code></pre></div><p><strong>ç»“æœé¢„æµ‹</strong></p>
<blockquote>
<ul>
<li>æ²¡æœ‰å†…å®¹è¾“å‡ºï¼Œdata åœ¨ if åˆ¤æ–­ä¹‹å‰è¢«æ”¹å˜</li>
<li>the value is 0 data åœ¨æ‰“å°æ•°æ®ä¹‹å‰è¢«è¯¥å˜</li>
<li>the value is 1 dataåœ¨ if åˆ¤æ–­ä¹‹åï¼Œæ‰“å°æ•°æ®ä¹‹å‰è¢«æ”¹å˜</li>
</ul>
</blockquote>
<p><strong>ç«æ€æ£€æµ‹</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">sun@sundeMacBook-Pro <span style="color:#f92672">[</span>16:57:47<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>~/VSCode/sinksmell/notes/ch01<span style="color:#f92672">]</span> 
-&gt; % go build -race race1.go 
sun@sundeMacBook-Pro <span style="color:#f92672">[</span>16:57:58<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>~/VSCode/sinksmell/notes/ch01<span style="color:#f92672">]</span> 
-&gt; % ls           
race1    race1.go
sun@sundeMacBook-Pro <span style="color:#f92672">[</span>16:58:03<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>~/VSCode/sinksmell/notes/ch01<span style="color:#f92672">]</span> 
-&gt; % ./race1            
the value is 0
<span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span>
WARNING: DATA RACE
Write at 0x00c0000b8008 by goroutine 7:
  main.main.func1<span style="color:#f92672">(</span><span style="color:#f92672">)</span>
      /Users/sun/VSCode/sinksmell/notes/ch01/race1.go:8 +0x4e

Previous read at 0x00c0000b8008 by main goroutine:
  main.main<span style="color:#f92672">(</span><span style="color:#f92672">)</span>
      /Users/sun/VSCode/sinksmell/notes/ch01/race1.go:10 +0x88

Goroutine <span style="color:#ae81ff">7</span> <span style="color:#f92672">(</span>running<span style="color:#f92672">)</span> created at:
  main.main<span style="color:#f92672">(</span><span style="color:#f92672">)</span>
      /Users/sun/VSCode/sinksmell/notes/ch01/race1.go:7 +0x7a
<span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span><span style="color:#f92672">=</span>
Found <span style="color:#ae81ff">1</span> data race<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span>

// ä»ä¸Šé¢è¾“å‡ºå¯ä»¥çœ‹åˆ°ï¼Œdata å€¼åœ¨æ”¹å˜å‰å°±è¢« main goroutine è¯»äº†
</code></pre></div><p><strong>ä¸´ç•Œèµ„æº</strong></p>
<blockquote>
<p>å¯ä»¥è¢«è¢«å¤šä¸ªè¿›ç¨‹/çº¿ç¨‹å…±äº«çš„èµ„æºï¼Œä¾‹å¦‚å…¨å±€å˜é‡ï¼Œå…±äº«å†…å­˜ï¼Œæ–‡ä»¶ç­‰</p>
</blockquote>
<p><strong>ä¸´ç•ŒåŒº</strong></p>
<blockquote>
<p>å¹¶ä¸æ˜¯æŸä¸ªåŒºåŸŸï¼Œè€Œæ˜¯è®¿é—®ä¸´ç•Œèµ„æºçš„ä¸€æ®µä»£ç </p>
</blockquote>
<p><strong>è§£å†³ç«æ€ï¼Œç±»ä¼¼æ“ä½œç³»ç»Ÿé‡Œç®¡ç†ä¸´ç•ŒåŒºï¼Œä¿è¯æŸä¸€æ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªè¿›ç¨‹/çº¿ç¨‹èƒ½è¿›å…¥ä¸´ç•ŒåŒºè®¿é—®ä¸´ç•Œèµ„æº</strong></p>
<blockquote>
<p>å¯å¯¹ä¸´ç•Œèµ„æºè¿›è¡ŒåŠ é”ï¼Œè§£å†³ä¸Šé¢ä¾‹å­ä¸­çš„é—®é¢˜</p>
</blockquote>
<p><strong>å°è¯•è§£é™¤ç«æ€</strong></p>
<blockquote>
<p>ğŸ‘‡çš„ä»£ç å®é™…ä¸Šä»ç„¶æœªæ˜ç¡®è§„å®šå“ªä¸ªgoroutineå…ˆè®¿é—®data,åªæ˜¯å¯¹ä¸´ç•ŒåŒºåŠ ä»¥ç®¡ç†</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;fmt&#34;</span>
	<span style="color:#e6db74">&#34;sync&#34;</span>
)

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>(){
	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">data</span> <span style="color:#66d9ef">int</span>
	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">mutex</span> <span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">Mutex</span>
	<span style="color:#66d9ef">go</span> <span style="color:#66d9ef">func</span>() {
		<span style="color:#a6e22e">mutex</span>.<span style="color:#a6e22e">Lock</span>()
		<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">mutex</span>.<span style="color:#a6e22e">Unlock</span>()
		<span style="color:#a6e22e">data</span> <span style="color:#f92672">++</span>
	}()
	<span style="color:#a6e22e">mutex</span>.<span style="color:#a6e22e">Lock</span>()
	<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">mutex</span>.<span style="color:#a6e22e">Unlock</span>()
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">data</span><span style="color:#f92672">==</span><span style="color:#ae81ff">0</span>{
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;the value is %v\n&#34;</span>,<span style="color:#a6e22e">data</span>)
	}
}

</code></pre></div><p><strong>å†æ¬¡æ£€æµ‹</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">sun@sundeMacBook-Pro <span style="color:#f92672">[</span>17:20:11<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>~/VSCode/sinksmell/notes/ch01<span style="color:#f92672">]</span> 
-&gt; % go build -race race1.go
sun@sundeMacBook-Pro <span style="color:#f92672">[</span>17:21:10<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>~/VSCode/sinksmell/notes/ch01<span style="color:#f92672">]</span> 
-&gt; % ./race1
the value is <span style="color:#ae81ff">0</span>
</code></pre></div><h3 id="atomicity-åŸå­æ€§">Atomicity åŸå­æ€§</h3>
<p><strong>åŸå­æ€§</strong></p>
<blockquote>
<p>åœ¨æŸä¸ªä¸Šä¸‹æ–‡ç¯å¢ƒä¸­ï¼Œä¸€ä¸ªæ“ä½œæ»¡è¶³ä¸å¯åˆ†å‰²ä¸å¯æ‰“æ–­ï¼Œå°±è®¤ä¸ºè¿™ä¸ªæ“ä½œå…·æœ‰åŸå­æ€§</p>
<blockquote>
<ul>
<li>ä¸Šä¸‹æ–‡çš„é‡è¦æ€§ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯ä½œç”¨åŸŸï¼Œä¾‹å¦‚åœ¨è¿›ç¨‹ä¸­çš„åŸå­æ“ä½œï¼Œæ”¾åˆ°æ“ä½œç³»ç»Ÿå±‚é¢æ¥çœ‹ï¼Œå¯èƒ½å°±ä¸æ˜¯åŸå­æ“ä½œã€‚</li>
</ul>
</blockquote>
</blockquote>
<p><strong>ç›´è§‰ä¸­çš„åŸå­æ“ä½œ</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>
</code></pre></div><blockquote>
<p>è¿™æ¡è¯­å¥çœ‹èµ·æ¥æ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼Œå®é™…ä¸Šä»æŒ‡ä»¤æ‰§è¡Œè§’åº¦å®ƒåˆ†ä¸º3æ­¥ï¼Œè™½ç„¶æ¯ä¸€æ­¥éƒ½æ˜¯åŸå­æ“ä½œï¼Œä½†æ˜¯ç»„åˆèµ·æ¥å°±ä¸æ˜¯äº†</p>
<ul>
<li>å–å‡ºiçš„å€¼</li>
<li>æŠŠiçš„å€¼åŠ ä¸€</li>
<li>å­˜å‚¨içš„å€¼</li>
</ul>
</blockquote>
<p><strong>åŸå­æ€§æœ‰ä½•æ„ä¹‰?</strong></p>
<blockquote>
<p>å¦‚æœä¸€ä¸ªæ“ä½œçš„åŸå­æ€§å¾—åˆ°äº†ä¿è¯ï¼Œé‚£ä¹ˆå¯ä»¥è®¤ä¸ºè¿™ä¸ªæ“ä½œæ˜¯<strong>å¹¶å‘å®‰å…¨</strong>çš„</p>
</blockquote>
<h3 id="memory-access-synchronization">Memory Access Synchronization</h3>
<blockquote>
<p>å®é™…ä¸Šå°±æ˜¯æ“ä½œç³»ç»Ÿä¸­å¯¹ä¸´ç•ŒåŒºçš„ç®¡ç†ï¼Œå¯å‚è€ƒçº¿ç¨‹ç¨‹ä¹‹é—´çš„åŒæ­¥ä¸äº’æ–¥</p>
</blockquote>
<h3 id="deadlockslivelocksand-starvation">Deadlocks,Livelocks,and Starvation</h3>
<h4 id="deadlock-æ­»é”">Deadlock æ­»é”</h4>
<blockquote>
<p>æ‰€æœ‰çš„å·¥ä½œè¿›ç¨‹/çº¿ç¨‹éƒ½åœ¨ç­‰å¾…å…¶ä»–çš„çº¿ç¨‹é‡Šæ”¾èµ„æº</p>
<p>æ­»é”å¿…è¦æ¡ä»¶</p>
<ul>
<li>èµ„æºç‹¬å æ€§</li>
<li>èµ„æºä¸å¯å‰¥å¤º</li>
<li>äº’æ–¥</li>
<li>ç›¸äº’ç­‰å¾…</li>
</ul>
</blockquote>
<p><strong>ç¤ºä¾‹ä»£ç </strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;fmt&#34;</span>
	<span style="color:#e6db74">&#34;sync&#34;</span>
	<span style="color:#e6db74">&#34;time&#34;</span>
)

<span style="color:#66d9ef">type</span>  <span style="color:#a6e22e">value</span>  <span style="color:#66d9ef">struct</span>{
    <span style="color:#a6e22e">mu</span> <span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">Mutex</span>
    <span style="color:#a6e22e">value</span> <span style="color:#66d9ef">int</span>
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>(){
	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">wg</span> <span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">WaitGroup</span>
	<span style="color:#a6e22e">printSum</span><span style="color:#f92672">:=</span> <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">v1</span>,<span style="color:#a6e22e">v2</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">value</span>) {
		<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">wg</span>.<span style="color:#a6e22e">Done</span>()
		<span style="color:#a6e22e">v1</span>.<span style="color:#a6e22e">mu</span>.<span style="color:#a6e22e">Lock</span>()
		<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">v1</span>.<span style="color:#a6e22e">mu</span>.<span style="color:#a6e22e">Unlock</span>()

		<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Sleep</span>(<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span><span style="color:#f92672">*</span><span style="color:#ae81ff">2</span>)
		<span style="color:#a6e22e">v2</span>.<span style="color:#a6e22e">mu</span>.<span style="color:#a6e22e">Lock</span>()
		<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">v2</span>.<span style="color:#a6e22e">mu</span>.<span style="color:#a6e22e">Unlock</span>()
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;sum=%v\n&#34;</span>,<span style="color:#a6e22e">v1</span>.<span style="color:#a6e22e">value</span><span style="color:#f92672">+</span><span style="color:#a6e22e">v2</span>.<span style="color:#a6e22e">value</span>)
	}

	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">a</span>,<span style="color:#a6e22e">b</span> <span style="color:#a6e22e">value</span>
	<span style="color:#a6e22e">wg</span>.<span style="color:#a6e22e">Add</span>(<span style="color:#ae81ff">2</span>)
	<span style="color:#66d9ef">go</span> <span style="color:#a6e22e">printSum</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">a</span>,<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">b</span>)
	<span style="color:#66d9ef">go</span> <span style="color:#a6e22e">printSum</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">b</span>,<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">a</span>)
	<span style="color:#a6e22e">wg</span>.<span style="color:#a6e22e">Wait</span>()

}

</code></pre></div><p><strong>è¿è¡Œç»“æœ</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">-&gt; % ./deadlock 
fatal error: all goroutines are asleep - deadlock!

goroutine <span style="color:#ae81ff">1</span> <span style="color:#f92672">[</span>semacquire<span style="color:#f92672">]</span>:
sync.runtime_Semacquire<span style="color:#f92672">(</span>0xc0000180c8<span style="color:#f92672">)</span>
        /usr/local/Cellar/go/1.13/libexec/src/runtime/sema.go:56 +0x42
sync.<span style="color:#f92672">(</span>*WaitGroup<span style="color:#f92672">)</span>.Wait<span style="color:#f92672">(</span>0xc0000180c0<span style="color:#f92672">)</span>
        /usr/local/Cellar/go/1.13/libexec/src/sync/waitgroup.go:130 +0x64
main.main<span style="color:#f92672">(</span><span style="color:#f92672">)</span>
        /Users/sun/VSCode/sinksmell/notes/ch01/deadlock.go:31 +0x122

goroutine <span style="color:#ae81ff">5</span> <span style="color:#f92672">[</span>semacquire<span style="color:#f92672">]</span>:
sync.runtime_SemacquireMutex<span style="color:#f92672">(</span>0xc0000180e4, 0x1051300, 0x1<span style="color:#f92672">)</span>
        /usr/local/Cellar/go/1.13/libexec/src/runtime/sema.go:71 +0x47
sync.<span style="color:#f92672">(</span>*Mutex<span style="color:#f92672">)</span>.lockSlow<span style="color:#f92672">(</span>0xc0000180e0<span style="color:#f92672">)</span>
        /usr/local/Cellar/go/1.13/libexec/src/sync/mutex.go:138 +0xfc
sync.<span style="color:#f92672">(</span>*Mutex<span style="color:#f92672">)</span>.Lock<span style="color:#f92672">(</span>...<span style="color:#f92672">)</span>
        /usr/local/Cellar/go/1.13/libexec/src/sync/mutex.go:81
main.main.func1<span style="color:#f92672">(</span>0xc0000180d0, 0xc0000180e0<span style="color:#f92672">)</span>
        /Users/sun/VSCode/sinksmell/notes/ch01/deadlock.go:22 +0x1f4
created by main.main
        /Users/sun/VSCode/sinksmell/notes/ch01/deadlock.go:29 +0xea

goroutine <span style="color:#ae81ff">6</span> <span style="color:#f92672">[</span>semacquire<span style="color:#f92672">]</span>:
sync.runtime_SemacquireMutex<span style="color:#f92672">(</span>0xc0000180d4, 0x1300, 0x1<span style="color:#f92672">)</span>
        /usr/local/Cellar/go/1.13/libexec/src/runtime/sema.go:71 +0x47
sync.<span style="color:#f92672">(</span>*Mutex<span style="color:#f92672">)</span>.lockSlow<span style="color:#f92672">(</span>0xc0000180d0<span style="color:#f92672">)</span>
        /usr/local/Cellar/go/1.13/libexec/src/sync/mutex.go:138 +0xfc
sync.<span style="color:#f92672">(</span>*Mutex<span style="color:#f92672">)</span>.Lock<span style="color:#f92672">(</span>...<span style="color:#f92672">)</span>
        /usr/local/Cellar/go/1.13/libexec/src/sync/mutex.go:81
main.main.func1<span style="color:#f92672">(</span>0xc0000180e0, 0xc0000180d0<span style="color:#f92672">)</span>
        /Users/sun/VSCode/sinksmell/notes/ch01/deadlock.go:22 +0x1f4
created by main.main
        /Users/sun/VSCode/sinksmell/notes/ch01/deadlock.go:30 +0x114

</code></pre></div><p><strong>åˆ†æ</strong></p>
<blockquote>
<ul>
<li>Main,printSum(&amp;a,&amp;b),printSum(&amp;b,&amp;a) ä¸‰ä¸ªgoroutine</li>
<li>Mainç­‰å¾…ä¸¤ä¸ªprintSumç®€è®°ä¸ºAï¼ŒBçš„è¿”å›</li>
<li>ç°åœ¨æœ‰ä¸¤ä¸ªèµ„æº a,b , A å ç”¨äº†a, B å ç”¨äº†b  <strong>ç‹¬å </strong></li>
<li>Aè¯·æ±‚èµ„æºb, Bè¯·æ±‚èµ„æºaï¼Œéƒ½ä¸æˆåŠŸï¼Œé™·å…¥ç­‰å¾…çŠ¶æ€  <strong>äº’æ–¥ï¼Œç›¸äº’ç­‰å¾…</strong></li>
<li>åˆæœ‰<strong>èµ„æºä¸å¯å‰¥å¤º</strong>ï¼Œäºæ˜¯æ­»é”å‡ºç°</li>
</ul>
</blockquote>
<p><img src="https://i.loli.net/2020/02/03/LSmNUEJQ4FH6apA.png" alt="image-20200201193204237.png"></p>
<h4 id="livelock-æ´»é”">Livelock æ´»é”</h4>
<blockquote>
<ul>
<li>
<p>æ´»é”æ˜¯æŒ‡å¹¶å‘åœ°æ“ä½œåœ¨æ­£å¸¸åœ°è¿›è¡Œï¼Œä½†æ˜¯å¹¶æ²¡æœ‰æ˜¯ç¨‹åºçš„çŠ¶æ€å‘å‰æ¨è¿›</p>
<blockquote>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œä½ èµ°åœ¨ä¸€æ¡ç‹­çª„è·¯ä¸Šï¼Œè¿é¢èµ°æ¥ä¸€ä¸ªäººï¼Œä½ å‘å·¦è¾¹èµ°ï¼Œç»™ä»–è®©è·¯ï¼Œä»–å‘å³è¾¹èµ°(ä½ çš„å·¦è¾¹)ç»™ä½ è®©è·¯ï¼Œç„¶åä½ æ„è¯†åˆ°äº†è¿™æ ·æ²¡åŠæ³•é€šè¿‡ï¼Œäºæ˜¯ä½ å‘å³è¾¹èµ°ï¼Œä»–åˆå‘å·¦è¾¹èµ°(ä½ çš„å³è¾¹)ï¼Œå¦‚æ­¤åå¤ï¼Œè°éƒ½ä¸èƒ½é€šè¿‡ã€‚</p>
</blockquote>
</li>
</ul>
</blockquote>
<p><strong>ä»£ç ç¤ºä¾‹</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;bytes&#34;</span>
	<span style="color:#e6db74">&#34;fmt&#34;</span>
	<span style="color:#e6db74">&#34;sync&#34;</span>
	<span style="color:#e6db74">&#34;sync/atomic&#34;</span>
	<span style="color:#e6db74">&#34;time&#34;</span>
)

<span style="color:#66d9ef">var</span> (
	<span style="color:#75715e">// æ§åˆ¶ä¸¤ä¸ªäººçš„è¡Œèµ°æ­¥è°ƒ
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">cadence</span> = <span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">NewCond</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">Mutex</span>{})
	<span style="color:#a6e22e">left</span>    <span style="color:#66d9ef">int32</span> <span style="color:#75715e">// 1è¡¨ç¤ºå‘å·¦èµ°,æ³¨æ„æ­¤å¤„çš„æ–¹å‘ä¸ºç›¸å¯¹äºç¬¬ä¸€ä¸ªäººçš„æ–¹å‘
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">right</span>   <span style="color:#66d9ef">int32</span> <span style="color:#75715e">// 1 è¡¨ç¤ºå‘å³èµ°
</span><span style="color:#75715e"></span>)

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {

	<span style="color:#66d9ef">go</span> <span style="color:#66d9ef">func</span>() {
		<span style="color:#66d9ef">for</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Tick</span>(<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Millisecond</span>) {
			<span style="color:#a6e22e">cadence</span>.<span style="color:#a6e22e">Broadcast</span>()
		}
	}()
	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">peoples</span> <span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">WaitGroup</span>
	<span style="color:#a6e22e">peoples</span>.<span style="color:#a6e22e">Add</span>(<span style="color:#ae81ff">2</span>)
	<span style="color:#66d9ef">go</span> <span style="color:#a6e22e">walk</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">peoples</span>, <span style="color:#e6db74">&#34;Alice&#34;</span>)
	<span style="color:#66d9ef">go</span> <span style="color:#a6e22e">walk</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">peoples</span>, <span style="color:#e6db74">&#34;David&#34;</span>)

	<span style="color:#a6e22e">peoples</span>.<span style="color:#a6e22e">Wait</span>()
}

<span style="color:#75715e">// æ¨¡æ‹Ÿä¸¤ä¸ªè¡Œäºº
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">walk</span>(<span style="color:#a6e22e">wg</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">WaitGroup</span>, <span style="color:#a6e22e">name</span> <span style="color:#66d9ef">string</span>) {
	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">out</span> <span style="color:#a6e22e">bytes</span>.<span style="color:#a6e22e">Buffer</span>
	<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">wg</span>.<span style="color:#a6e22e">Done</span>()
	<span style="color:#66d9ef">defer</span> <span style="color:#66d9ef">func</span>() {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">String</span>())
	}()
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Fprintf</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">out</span>, <span style="color:#e6db74">&#34;%v is trying to scoot:&#34;</span>, <span style="color:#a6e22e">name</span>)
	<span style="color:#75715e">// è®¾ç½®è½¬å‘æ¬¡æ•°ä¸º5
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> &lt; <span style="color:#ae81ff">5</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> {
		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">tryLeft</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">out</span>) <span style="color:#f92672">||</span> <span style="color:#a6e22e">tryRight</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">out</span>) {
			<span style="color:#66d9ef">return</span>
		}
	}
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Fprintf</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">out</span>, <span style="color:#e6db74">&#34;\n %v give up!&#34;</span>, <span style="color:#a6e22e">name</span>)
}

<span style="color:#75715e">// å°è¯•å‘å·¦èµ°
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">tryLeft</span>(<span style="color:#a6e22e">out</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">bytes</span>.<span style="color:#a6e22e">Buffer</span>) <span style="color:#66d9ef">bool</span> {
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">tryDirection</span>(<span style="color:#e6db74">&#34;left&#34;</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">left</span>, <span style="color:#a6e22e">out</span>)
}

<span style="color:#75715e">// å°è¯•å‘å³èµ°
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">tryRight</span>(<span style="color:#a6e22e">out</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">bytes</span>.<span style="color:#a6e22e">Buffer</span>) <span style="color:#66d9ef">bool</span> {
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">tryDirection</span>(<span style="color:#e6db74">&#34;right&#34;</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">right</span>, <span style="color:#a6e22e">out</span>)
}

<span style="color:#75715e">// æ¨¡æ‹Ÿè¡Œèµ°,ä¸¤ä¸ªäººæ­¥è°ƒè¦ä¸€è‡´
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">takeStep</span>() {
	<span style="color:#a6e22e">cadence</span>.<span style="color:#a6e22e">L</span>.<span style="color:#a6e22e">Lock</span>()
	<span style="color:#a6e22e">cadence</span>.<span style="color:#a6e22e">Wait</span>()
	<span style="color:#a6e22e">cadence</span>.<span style="color:#a6e22e">L</span>.<span style="color:#a6e22e">Unlock</span>()
}

<span style="color:#75715e">// å°è¯•å‘æŸä¸ªæ–¹å‘ç§»åŠ¨
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">tryDirection</span>(<span style="color:#a6e22e">dirName</span> <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">dir</span> <span style="color:#f92672">*</span><span style="color:#66d9ef">int32</span>, <span style="color:#a6e22e">out</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">bytes</span>.<span style="color:#a6e22e">Buffer</span>) <span style="color:#66d9ef">bool</span> {
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Fprintf</span>(<span style="color:#a6e22e">out</span>, <span style="color:#e6db74">&#34; %v&#34;</span>, <span style="color:#a6e22e">dirName</span>)
	<span style="color:#a6e22e">atomic</span>.<span style="color:#a6e22e">AddInt32</span>(<span style="color:#a6e22e">dir</span>, <span style="color:#ae81ff">1</span>)
	<span style="color:#a6e22e">takeStep</span>()
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">atomic</span>.<span style="color:#a6e22e">LoadInt32</span>(<span style="color:#a6e22e">dir</span>) <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span> {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Fprintf</span>(<span style="color:#a6e22e">out</span>, <span style="color:#e6db74">&#34;. Success!&#34;</span>)
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>
	}
	<span style="color:#a6e22e">takeStep</span>()
	<span style="color:#a6e22e">atomic</span>.<span style="color:#a6e22e">AddInt32</span>(<span style="color:#a6e22e">dir</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)
	<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>
}

</code></pre></div><p><strong>è¿è¡Œç»“æœ</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">Alice is trying to scoot: left right left right left right left right left right
 Alice give up!
David is trying to scoot: left right left right left right left right left right
 David give up!
</code></pre></div><p><strong>æ‹“å±•</strong></p>
<blockquote>
<ul>
<li><strong>ç¨‹åºæ­£å¸¸å·¥ä½œä¹Ÿæœ‰å¯èƒ½å‡ºç°æ´»é”ç°è±¡</strong></li>
<li><strong>æ´»é”</strong>æ˜¯é¥¥é¥¿ç°è±¡çš„ä¸€ä¸ªå­é›†</li>
</ul>
</blockquote>
<h4 id="starvation-é¥¥é¥¿">Starvation é¥¥é¥¿</h4>
<blockquote>
<ul>
<li>å¦‚æœå¹¶å‘çš„çº¿ç¨‹/è¿›ç¨‹ä¸èƒ½è·å–å®ƒæ‰€éœ€çš„æ‰€æœ‰èµ„æºï¼Œå°±è®¤ä¸ºå‡ºç°äº†é¥¥é¥¿</li>
<li>é¥¥é¥¿é€šå¸¸æ„å‘³ç€ï¼Œä¸€ä¸ªæˆ–å¤šä¸ªçš„çº¿ç¨‹/è¿›ç¨‹é˜»ç¢å…¶ä»–çº¿ç¨‹/è¿›ç¨‹é«˜æ•ˆåœ°å·¥ä½œ</li>
</ul>
</blockquote>
<p><strong>ä»£ç ç¤ºä¾‹</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;fmt&#34;</span>
	<span style="color:#e6db74">&#34;sync&#34;</span>
	<span style="color:#e6db74">&#34;time&#34;</span>
)

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">wg</span> <span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">WaitGroup</span>
	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">shardLock</span> <span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">Mutex</span>
	<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">runtime</span> = <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span>

	<span style="color:#a6e22e">greedyWorker</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">func</span>() {
		<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">wg</span>.<span style="color:#a6e22e">Done</span>()
		<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">count</span> <span style="color:#66d9ef">int</span>
    <span style="color:#75715e">// è´ªå©ªçš„å·¥ä½œè€…ï¼Œåœ¨æ•´ä¸ªå·¥ä½œæ—¶é—´å†…éƒ½æŒæœ‰é”
</span><span style="color:#75715e"></span>		<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">begin</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>(); <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Since</span>(<span style="color:#a6e22e">begin</span>) <span style="color:#f92672">&lt;=</span> <span style="color:#a6e22e">runtime</span>; {
			<span style="color:#a6e22e">shardLock</span>.<span style="color:#a6e22e">Lock</span>()
			<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Sleep</span>(<span style="color:#ae81ff">3</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Nanosecond</span>)
			<span style="color:#a6e22e">shardLock</span>.<span style="color:#a6e22e">Unlock</span>()
			<span style="color:#a6e22e">count</span><span style="color:#f92672">++</span>
		}
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;Greedy worker was able to execute %v work loops\n&#34;</span>, <span style="color:#a6e22e">count</span>)
	}

	<span style="color:#a6e22e">politeWorker</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">func</span>() {
		<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">wg</span>.<span style="color:#a6e22e">Done</span>()
		<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">count</span> <span style="color:#66d9ef">int</span>
    <span style="color:#75715e">// ç¤¼è²Œçš„å·¥ä½œè€…ï¼Œåœ¨éœ€è¦çš„æ—¶å€™è·å–é”
</span><span style="color:#75715e"></span>		<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">begin</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>(); <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Since</span>(<span style="color:#a6e22e">begin</span>) <span style="color:#f92672">&lt;=</span> <span style="color:#a6e22e">runtime</span>; {
			<span style="color:#a6e22e">shardLock</span>.<span style="color:#a6e22e">Lock</span>()
			<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Sleep</span>(<span style="color:#ae81ff">1</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Nanosecond</span>)
			<span style="color:#a6e22e">shardLock</span>.<span style="color:#a6e22e">Unlock</span>()

			<span style="color:#a6e22e">shardLock</span>.<span style="color:#a6e22e">Lock</span>()
			<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Sleep</span>(<span style="color:#ae81ff">1</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Nanosecond</span>)
			<span style="color:#a6e22e">shardLock</span>.<span style="color:#a6e22e">Unlock</span>()

			<span style="color:#a6e22e">shardLock</span>.<span style="color:#a6e22e">Lock</span>()
			<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Sleep</span>(<span style="color:#ae81ff">1</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Nanosecond</span>)
			<span style="color:#a6e22e">shardLock</span>.<span style="color:#a6e22e">Unlock</span>()

			<span style="color:#a6e22e">count</span><span style="color:#f92672">++</span>
		}
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;Polite worker was able to execute %v work loops\n&#34;</span>, <span style="color:#a6e22e">count</span>)
	}

	<span style="color:#a6e22e">wg</span>.<span style="color:#a6e22e">Add</span>(<span style="color:#ae81ff">2</span>)
	<span style="color:#66d9ef">go</span> <span style="color:#a6e22e">greedyWorker</span>()
	<span style="color:#66d9ef">go</span> <span style="color:#a6e22e">politeWorker</span>()

	<span style="color:#a6e22e">wg</span>.<span style="color:#a6e22e">Wait</span>()
}

</code></pre></div><p><strong>è¿è¡Œç»“æœ</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">Greedy worker was able to execute <span style="color:#ae81ff">657044</span> work loops
Polite worker was able to execute <span style="color:#ae81ff">369205</span> work loops
</code></pre></div><p><strong>ç»“æœåˆ†æ</strong></p>
<blockquote>
<ul>
<li>è´ªå©ªçš„å·¥ä½œè€…ä¸ç¤¼è²Œçš„å·¥ä½œè€…è™½ç„¶å·¥ä½œæ—¶é—´ç›¸åŒï¼Œä½†æ˜¯å‰è€…çš„å·¥ä½œé‡å‡ ä¹è¾¾åˆ°äº†åè€…çš„ä¸¤å€</li>
<li>è´ªå©ªå·¥ä½œè€…å°†é”çš„æ§åˆ¶æ‹“å±•åˆ°äº†ä¸´ç•ŒåŒºçš„å¤–é¢</li>
<li>å¹¶ä¸æ˜¯è´ªå©ªå·¥ä½œè€…çš„ç®—æ³•æ›´é«˜æ•ˆï¼Œè€Œæ˜¯é€šè¿‡é¥¥é¥¿äº†å…¶ä»–å·¥ä½œè€…æ¥æé«˜äº†å·¥ä½œæ•ˆç‡</li>
</ul>
</blockquote>
<p><strong>æ‹“å±•</strong></p>
<blockquote>
<ul>
<li>ä¸ºäº†é¿å…é¥¥é¥¿å…¶ä»–å·¥ä½œçº¿ç¨‹ï¼Œåº”è¯¥åªé”å®šä¸´ç•ŒåŒº</li>
<li>å¦‚æœå‡ºç°äº†åŒæ­¥çš„æ€§èƒ½é—®é¢˜å†è€ƒè™‘æ‹“å±•èŒƒå›´</li>
</ul>
</blockquote>
<h3 id="determining-concurrency-safety-ç¡®å®šå¹¶å‘å®‰å…¨">Determining Concurrency Safety ç¡®å®šå¹¶å‘å®‰å…¨</h3>
<blockquote>
<ul>
<li>ç¼–å†™å‡½æ•°æ—¶ï¼Œè¦ç¡®å®šä¸€ä¸ªå‡½æ•°çš„å¹¶å‘å®‰å…¨æ€§</li>
<li>å¤§æ„å°±æ˜¯é€šè¿‡å‡½æ•°çš„åŸå‹ï¼Œæ³¨é‡Šæ¥è¯´æ˜æŸä¸ªå‡½æ•°æ˜¯å¦é€‚ç”¨å¹¶å‘åœºæ™¯</li>
</ul>
</blockquote>

    </div>

    <div class="post-copyright">
            
    </div>

  
    <div class="post-tags">
        
            <section>
            <i class="iconfont icon-tag"></i>Tag(s): 
            
            <span class="tag"><a href="https://sinksmell.github.io/tags/concurrency-in-go/">
                    #concurrency in go</a></span>
            
            <span class="tag"><a href="https://sinksmell.github.io/tags/chapter1/">
                    #chapter1</a></span>
            
            </section>
        
        <section>
                <a href="javascript:window.history.back();">back</a></span> Â· 
                <span><a href="https://sinksmell.github.io">home</a></span>
        </section>
    </div>

    <div class="post-nav">
        
        <a href="https://sinksmell.github.io/2020/leetcode-bsearch/" class="prev" rel="prev" title="LeetCode äºŒåˆ†æŸ¥æ‰¾ä¸“é¡¹ç»ƒä¹ "><i class="iconfont icon-left"></i>&nbsp;LeetCode äºŒåˆ†æŸ¥æ‰¾ä¸“é¡¹ç»ƒä¹ </a>
         
        
    </div>

    <div class="post-comment">
          
                 
          
    </div>
</article>
          </div>
		   </main>
      <footer class="footer">
    <div class="copyright">
        &copy;
        
        <span itemprop="copyrightYear">2019 - 2020</span>
        
        <span class="with-love">
    	 <i class="iconfont icon-love"></i> 
         </span>
         
            <span class="author" itemprop="copyrightHolder"><a href="https://sinksmell.github.io">sinksmell</a> | </span> 
         

         
		  <span>
           Powered by
           <a href="https://gohugo.io/" target="_blank" rel="external nofollow">Hugo</a>
           <span> &  </span>
           <a href="https://github.com/cyseria/LeaveIt" target="_blank" rel="external nofollow">LeaveIt</a>
         </span> 
      </div>
</footer>














<script type="text/javascript">
    var message_Path = "/live2d/"
    var home_Path = "https://sinksmell.github.io/"  
</script>


    
     <link href="//lib.baomitu.com/lightgallery/1.6.11/css/lightgallery.min.css" rel="stylesheet">  
      
     <script src="/js/vendor_gallery.min.js" async="" ></script>
    




     </div>
  
  </body>
</html>
